<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cargo Authentication - Release Pilot</title>
  <link rel="icon" type="image/svg+xml" href="../assets/release-pilot-logo.svg">
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <div class="container">
    <nav><a href="../"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>Back to Documentation</a></nav>
    
    <h1>
      <img src="https://rust-lang.org/logos/rust-logo-512x512.png" alt="Rust">
      Cargo Authentication
    </h1>
    <p class="subtitle">Publish Rust crates to crates.io</p>

    <h2>Option 1: Pass Token as Input</h2>
    <div class="note recommended">
      <div class="note-title">Recommended</div>
      Simple and secure - the token is passed directly to <code>cargo publish --token</code>.
    </div>
    <pre><code>- uses: a-line-services/release-pilot@v1
  with:
    cargo-token: ${{ secrets.CARGO_REGISTRY_TOKEN }}</code></pre>
    
    <h3>Getting a crates.io Token</h3>
    <ol>
      <li>Go to <a href="https://crates.io/settings/tokens">crates.io/settings/tokens</a></li>
      <li>Click "New Token"</li>
      <li>Give it a name (e.g., "GitHub Actions")</li>
      <li>Select scopes: <code>publish-new</code> and <code>publish-update</code></li>
      <li>Copy the token and add it as <code>CARGO_REGISTRY_TOKEN</code> secret in your repo</li>
    </ol>

    <h2>Option 2: Pre-configure Credentials</h2>
    <p>If you prefer to configure credentials manually:</p>
    <pre><code>- name: Configure Cargo credentials
  run: |
    mkdir -p ~/.cargo
    cat > ~/.cargo/credentials.toml << EOF
    [registry]
    token = "${{ secrets.CARGO_REGISTRY_TOKEN }}"
    EOF

- uses: a-line-services/release-pilot@v1</code></pre>

    <h2>Option 3: Environment Variable</h2>
    <p>Cargo also respects the <code>CARGO_REGISTRY_TOKEN</code> environment variable:</p>
    <pre><code>- uses: a-line-services/release-pilot@v1
  env:
    CARGO_REGISTRY_TOKEN: ${{ secrets.CARGO_REGISTRY_TOKEN }}</code></pre>

    <h2>Publishing Requirements</h2>
    <div class="note">
      <div class="note-title">Before Publishing</div>
      <p>Ensure your <code>Cargo.toml</code> has all required fields:</p>
      <pre><code>[package]
name = "your-crate"
version = "0.1.0"
edition = "2021"
license = "MIT"
description = "A short description"
repository = "https://github.com/you/your-crate"</code></pre>
    </div>

    <h2>Workspaces</h2>
    <p>For Cargo workspaces, configure each crate as a separate package:</p>
    <pre><code># .github/release-pilot.yml
packages:
  - name: core
    ecosystem: cargo
    path: ./crates/core

  - name: cli
    ecosystem: cargo
    path: ./crates/cli

releaseOrder:
  - core
  - cli</code></pre>

    <h2>Inputs Reference</h2>
    <table>
      <thead>
        <tr>
          <th>Input</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>cargo-token</code></td>
          <td>crates.io API token</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
  </div>
</body>
</html>
